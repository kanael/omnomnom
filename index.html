<!DOCTYPE html>
<html>
   <head>
      <title>Omnomnom !</title>
      <link rel = "import"
         href = "https://cdn.rawgit.com/download/polymer-cdn/1.0.1/lib/paper-input/paper-input.html">
      <link rel = "import"
         href = "https://cdn.rawgit.com/download/polymer-cdn/1.0.1/lib/iron-ajax/iron-ajax.html">
   </head>

   <body>
      <dom-module id = "data-bind">

        <h1>Welcome to Omnomnom !</h1>

         <template>
            <paper-input label = "Enter a dish... (f.e Schnitzel)" id = "input" value = "{{q::input}}"
              on-change="trigger"
              autofocus>
            </paper-input>
            <p>Searching for: <b>{{q}}</b></p>

            <div id=results></div>

            <iron-ajax auto
              id="ajaxSearch"
              url="http://127.0.0.1:5000/search"
              params = "{{ getParams() }}" handle-as = "json" on-response = "_handleResponse"
              debounce-duration = "500">
            </iron-ajax>
         </template>

         <script>
            (function () {
               Polymer ({
                  is: 'data-bind',
                  _handleResponse: function(event, request) {
                    var response = request.response;
                    results = ""
                    results += "<table border='1'>"
                    for (row in response) {
                      results += "<tr>"
                      for (col in response[row]) {
                        results += "<td>" + response[row][col] + "</td>";
                      }
                      results += "</tr>"
                    }
                    results += "</table>"
                    document.getElementById('results').innerHTML = results;
                  },
                  getParams: function() {
                    console.log("getParams");
                    console.log(this.$.input.value);
                    return {"q":this.$.input.value};
                  },
                  trigger: function() {
                    console.log("triggering generateRequest");
                    this.$.ajaxSearch.params = {"q":this.$.input.value};
                    this.$.ajaxSearch.generateRequest();
                  }
               });
            })();
         </script>
      </dom-module>

      <data-bind></data-bind>
   </body>
</html>
