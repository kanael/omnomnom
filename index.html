<!DOCTYPE html>
<html>
   <head>
      <meta charset="utf-8" />
      <title>אומנומנומ !</title>
      <link rel = "import"
         href = "https://cdn.rawgit.com/download/polymer-cdn/1.0.1/lib/paper-input/paper-input.html">
      <link rel = "import"
         href = "https://cdn.rawgit.com/download/polymer-cdn/1.0.1/lib/iron-ajax/iron-ajax.html">
      <link rel="import" href="bower_components/aha-table/src/aha-table.html">
      <link href="https://fonts.googleapis.com/css?family=Varela+Round" rel="stylesheet">

   </head>

   <body dir="rtl" style="font-family: 'Varela Round', 'sans-serif';">
      <dom-module id = "data-bind">

        <h1>אומנומנומ לשירותכם</h1>

         <template>
            <paper-input label = "הכנס מנה (לדוגמה: המבורגר)" id = "input" value = "{{q::input}}"
              on-change="trigger"
              autofocus>
            </paper-input>
            <div id="looking"></div>
            <aha-table id="results" pagesize="20">
              <aha-column name="name" label="שם המנה" type="string" sortable></aha-column>
              <aha-column name="price" label="מחיר" type="string" sortable></aha-column>
              <aha-column name="restaurant" label="לאן ללכת" type="string" sortable></aha-column>
            </aha-table>

            <iron-ajax auto
              id="ajaxSearch"
              url="http://127.0.0.1:5000/search"
              params = "{{ getParams() }}" handle-as = "json" on-response = "_handleResponse"
              debounce-duration = "500">
            </iron-ajax>
         </template>

        <script>
            (function () {
               Polymer ({
                  is: 'data-bind',
                  _handleResponse: function(event, request) {
                    var response = request.response;
                    if (!response) {
                      console.log("No results")
                      return
                    }
                    var looking = this.$.input.value
                    if (!looking) {
                      looking = "הכל"
                    }
                    document.getElementById("looking").innerHTML = "<p>מחפשת: <b>" + looking + "</b></p>"
                    document.getElementById("results").data = response;
                  },
                  getParams: function() {
                    console.log("getParams");
                    console.log(this.$.input.value);
                    return {"q":this.$.input.value};
                  },
                  trigger: function() {
                    console.log("triggering generateRequest");
                    this.$.ajaxSearch.params = {"q":this.$.input.value};
                    this.$.ajaxSearch.generateRequest();
                  }
               });
            })();
        </script>

      </dom-module>

      <data-bind></data-bind>
   </body>
</html>
